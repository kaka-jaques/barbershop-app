<div class="ion-page" #presentingElement>
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-button (click)="goBack()">Back</ion-button>
      </ion-buttons>
      <ion-title>Serviços</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item *ngIf="requestError">
        <ion-button (click)="tryRequestAgain()" style="margin: auto;" fill="clear" class="text-warning">
          <ion-icon name="warning-outline"></ion-icon>
          Tentar Novamente!
        </ion-button>
      </ion-item>
      <ion-item *ngIf="!requestError">
        <ion-button id="open-add-modal" style="margin: auto;" fill="clear">
          <ion-icon name="add-circle"></ion-icon>
          Novo Serviço
        </ion-button>
      </ion-item>
      <ion-item *ngFor="let service of servicesData" (click)="openService(service, serviceModal)" [button]="true">
        <ion-label id="trigger-{{service.id}}">{{service.name}}</ion-label>
        <ion-popover trigger="trigger-{{service.id}}" triggerAction="hover">
          <ng-template>
            <ion-content class="bg-dark">
              <ion-list>
                <ion-item color="light">Preço: R${{ service.price }}</ion-item>
                <ion-item color="light">Tempo: {{ service.duration[0] }}h{{ service.duration[1] }}</ion-item>
              </ion-list>
            </ion-content>
          </ng-template>
        </ion-popover>
      </ion-item>
      <ion-modal #serviceModal [presentingElement]="presentingElement">
        <ng-template>
          <ion-header>
            <ion-toolbar>
              <ion-buttons>
                <ion-button (click)="serviceModal.dismiss()">Sair</ion-button>
              </ion-buttons>
              <ion-title>{{ selectedService.name }}</ion-title>
              <ion-buttons slot="end">
                <ion-button (click)="updateService(serviceModal)">Salvar</ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content>
            <ion-list>
              <ion-item>
                <ion-input label="Serviço" [(ngModel)]="selectedService.name"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label>Duração</ion-label>
                <ion-datetime-button label="Duração" datetime="serviceDuration"></ion-datetime-button>
              </ion-item>
            </ion-list>
            <ion-modal [keepContentsMounted]="true">
              <ng-template>
                <ion-datetime id="serviceDuration"
                presentation="time"
                [(ngModel)]="timeString"
                [formatOptions]="{
                  time:{
                    hour: '2-digit',
                    minute: '2-digit'
                  }
                }"
                ></ion-datetime>
              </ng-template>
            </ion-modal>
          </ion-content>
        </ng-template>
      </ion-modal>
      <ion-item [button]="true" *ngIf="!servicesData && !requestError">
        <ion-label>
          <ion-skeleton-text [animated]="true"></ion-skeleton-text>
        </ion-label>
      </ion-item>
    </ion-list>
    <ion-toast color="{{ toastColor }}" [isOpen]="isToastOpen" message="{{ toastMessage }}" [duration]="3000"
      position="bottom" swiperGesture="vertical" class="text-light"></ion-toast>
  </ion-content>
</div>